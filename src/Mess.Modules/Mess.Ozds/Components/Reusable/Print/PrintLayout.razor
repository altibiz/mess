@using MudBlazor.ThemeManager

@inherits LayoutShapeComponentBase

<HeadContent>
  @{
    var siteName = Site?.SiteName;
    if (siteName is not null) {
      <title>
        @RenderTitleSegments(siteName, "before");
      </title>
    }
  }

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  @HeadMeta

  @Meta
  @HeadLink
  @HeadScript
  @Stylesheet

  <style>
    :root {
      --page-width: 8.27in;
      --page-height: 11.69in;
      --page-margin-inline: 0.55in;
      --page-margin-top: 0.39in;
      --page-margin-bottom: 0.20in;
      --page-header-height: 1.26in;
      --page-footer-height: 0.65in;
    }

    @@page {
      margin: 0;
      size: var(--page-width) var(--page-height);
    }

    * {
      font-size: 11pt;
    }

    table * {
      font-size: 8pt;
    }

    .container {
      max-width: var(--page-width);
      margin: 0 auto;
      padding-inline: var(--page-margin-inline);
    }

    @@media screen {
      .container {
        border-inline: 2px solid black;
      }
    }

    .page {
      page-break-after: always;
      padding-top: var(--page-margin-top);
      padding-bottom: var(--page-margin-bottom);
    }
    .page:last-child {
      page-break-after: avoid;
    }
    @@media print {
      .page-break {
        display: none;
      }
    }
    @@media screen {
      .page-break {
        border-block: 2px solid black;
        margin-inline: calc(var(--page-margin-inline) * -1);
        text-align: center;
      }
      .page-break::after {
        content: "PAGE BREAK";
      }
    }

    .page-content {
      height: calc(
        var(--page-height)
        - var(--page-margin-top)
        - var(--page-margin-bottom)
        - var(--page-header-height)
        - var(--page-footer-height));
    }
    .page-header {
      height: var(--page-header-height);
      position: relative;
    }
    .page-header > img {
      position: absolute;
      top: 0;
      border-bottom: 1px solid #DDDDDD;
      margin-top: calc(var(--page-margin-top) * -1);
      margin-inline: calc(var(--page-margin-inline) * -1);
    }
    .page-footer {
      height: var(--page-footer-height);
      position: relative;
    }
    .page-footer > img {
      position: absolute;
      bottom: 0;
      border-top: 1px solid #DDDDDD;
      margin-bottom: calc(var(--page-margin-bottom) * -1);
      margin-inline: calc(var(--page-margin-inline) * -1);
    }
  </style>
</HeadContent>

<MudThemeProvider Theme="_themeManager.Theme" />

<div class="container">
  @Body
</div>

@code {
  private ThemeManagerTheme _themeManager = new ThemeManagerTheme();

  private RenderFragment? HeadMeta { get; set; }

  protected override void OnLayoutInitialized()
  {
    // TODO: make this thing
    // _themeManager.Theme = new HelbMudTheme();
    _themeManager.DrawerClipMode = DrawerClipMode.Always;
    _themeManager.FontFamily = "Roboto";
    _themeManager.DefaultBorderRadius = 3;
  }

  protected override async Task OnLayoutInitializedAsync() {
    HeadMeta = await RenderSectionAsync("HeadMeta", false);
  }
}
